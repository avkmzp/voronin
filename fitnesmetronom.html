<!DOCTYPE html>
<html lang="ru-RU">
<head>
    <meta charset="UTF-8">
    <title>Тренировочная зона</title>
    <link rel="stylesheet" href="styles/style_login.css">
    <link rel="icon" href="favicon.ico">
    <script src="scripts/NoSleep.js"></script>
    <script>
        var noSleep = new NoSleep();
        var noSleepPresnt = false;

        function enableNoSleep() {
            if (!noSleepPresnt) {
                noSleep.enable();
                document.getElementById('sleep').style.color = 'yellow';
                document.getElementById('sleep').style.backgroundColor = 'blue';
                document.getElementById('sleep').innerHTML = '☀';
                noSleepPresnt = true;
            } else {
                noSleep.disable();
                document.getElementById('sleep').style.color = 'aliceblue';
                document.getElementById('sleep').style.backgroundColor = 'darkslategrey';
                document.getElementById('sleep').innerHTML = '☽';
                noSleepPresnt = false;
            }
        }

        var metroInterval = 2000;
        var count = '0';
        var pause = false;
        var start = false;
        var intervals2 = [30, 60, 90, 120, 150, 180, 210, 240, 280, 320, 360, 400, 430, 460, 490, 520];
        var intervals6 = [27, 54, 81];
        var context = new window.AudioContext();
        var intervals = intervals2;

        function startTimer() {
            if (start) {
                clearInterval(idTimer);
                start = false;
                count = 0;
                document.getElementById('count').innerHTML = 0;
                if (metroInterval == 2000) {
                    intervals = intervals2
                } else {
                    intervals = intervals6
                }
                document.getElementById('start').value = "Старт";
                document.getElementById('pause').value = "Пауза";
                pause = false;
                return;
            }
            start = true;
            pause = false;
            var peek = intervals.shift();
            document.getElementById('start').value = "Сброс";
            idTimer = setInterval(function () {
                if (!pause) {
                    count++;
                    if (count == peek) {
                        freq = 500;
                        delta = 1;
                        peek = intervals.shift();
                    } else {
                        freq = 440;
                        delta = 0.2;
                    }
                    var oscillator = context.createOscillator();
                    var now = context.currentTime;
                    oscillator.type = 'sine';
                    oscillator.frequency.value = freq;
                    oscillator.connect(context.destination);
                    oscillator.start(now);
                    oscillator.stop(now + delta);
                }
                document.getElementById('count').innerHTML = count;
            }, metroInterval)
        }

        function pauseTimer() {
            if (pause) {
                document.getElementById('pause').value = "Пауза";
                pause = false;
            }
            else {
                document.getElementById('pause').value = "Продолжить";
                pause = true;
            }
        }

        function setting() {
            if (metroInterval == 2000) {
                metroInterval = 6000;
                intervals = intervals6;
                document.getElementById('setting').value = "1/10";
            } else {
                metroInterval = 2000;
                intervals = intervals2;
                document.getElementById('setting').value = "1/30";
            }
        }
    </script>
</head>
<body>
<div>
    <div id="sleep" onclick="enableNoSleep()">
        ☽
    </div>
    <div id="count">
        0
    </div>
    <input id='start' value="Старт" type="button" onclick="startTimer()">
    <input id='pause' value="Пауза" type="button" onclick="pauseTimer()">
    <input id='setting' value="1/30" type="button" onclick="setting()">
</div>
</body>
</html>